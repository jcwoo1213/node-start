<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div
      class="container d-flex justify-content-center align-items-center vh-100"
    >
      <div class="card p-4 shadow" style="width: 350px">
        <h4 class="text-center mb-4">로그인</h4>

        <form id="loginForm">
          <div class="mb-3">
            <label class="form-label">아이디</label>
            <input type="text" class="form-control" id="userId" required />
          </div>

          <div class="mb-3">
            <label class="form-label">비밀번호</label>
            <input type="password" class="form-control" id="userPw" required />
          </div>

          <button type="submit" class="btn btn-primary w-100">로그인</button>
        </form>
        <div class="text-center">
          <span class="text-muted">아직 회원이 아니신가요?</span>
          <a href="/" class="ms-1">회원가입</a>
        </div>
      </div>
    </div>

    <script>
      document.querySelector(`#loginForm`).addEventListener("submit", (e) => {
        e.preventDefault();
        const login_id = document.querySelector(`#userId`).value;
        const login_pw = document.querySelector(`#userPw`).value;
        console.log(login_id, login_pw);
        fetch("/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ login_id, login_pw }),
        })
          .then((resp) => resp.json())
          .then((res) => {
            if (res.retCode == "Success") {
              alert(`${res.name}님 환영합니다`);
              localStorage.setItem("name", res.name);
              localStorage.setItem("role", res.role);
              localStorage.setItem("id", res.id);
              location.href = "member.html";
            } else if (res.retCode == "Fail") {
              alert(res.retMsg);
            } else {
              alert("error");
            }
          })
          .catch((err) => {
            console.log(err);
          });
      });
    </script>
  </body>
</html>
